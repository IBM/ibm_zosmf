# Copyright (c) IBM Corporation 2025
# This playbook demonstrates using roles:
# 'zmf_swupdate_start' and
# 'zmf_swupdate_retrieve' to complete the software management
# software update Start and Retrieve REST APIs.

#######################################################################################
# PLAY #1: Start a Software Update on a Software Instance.                            #
#######################################################################################
- name: Start a Software Update on a Software Instance
  hosts: swupdate_start
  gather_facts: false
  collections:
    - ibm.ibm_zosmf
  tasks:
    - name: Start Software Update
      include_role:
        name: zmf_swupdate_start

#######################################################################################
# PLAY #2: Retrieve the Status of the Software Update.                                #
#######################################################################################
- name: Retrieve the Status of the Software Update
  hosts: swupdate_start
  gather_facts: false
  collections:
    - ibm.ibm_zosmf
  tasks:
    - name: Retrieve Software Update Status
      include_role:
        name: zmf_swupdate_retrieve

#TODO trying prompt
#- hosts: swupdate_start
  #serial:
  #  - 1
  #  - 3
#  gather_facts: false
#  tasks:
#    - pause:
#        prompt: "The software update process has holds to resolve. Specify a JSON array of resolve-holds in the following format: "
#        echo: true
#      register: confirm_reboot
#      run_once: true
#    - debug:
#        msg: "The following array was specified for resolve-holds: {{ inventory_hostname }}"
#      when: confirm_reboot.user_input|lower == 'y'

#TODO call copy only when process is complete/canceled/canceled with error

#######################################################################################
# PLAY #3: Copy the Software Update output to a directory.                            #
#######################################################################################
#- name: Copy the output from the Software Update
#  hosts: swupdate_start
#  gather_facts: false
#  collections:
#    - ibm.ibm_zosmf
#  tasks:
#    - name: Copy Software Update
#      include_role:
#        name: zmf_swmgmt_swupdate_copy
